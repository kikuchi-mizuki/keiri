# サブスクリプション課金型サービスLP 要件定義書

## 1. プロジェクト概要

### 基本情報
- **プロジェクト名**: サブスクリプション課金型サービスLP開発
- **目的**: 月額課金＋コンテンツごとの従量課金を導入し、LINE連携で使いやすいサブスク提供を実現する
- **主な利用者**: LINEを利用する一般ユーザー
- **使用技術**: Python（Flask）／HTML・CSS／Stripe API／LINE Messaging API／Cursor（補助）

## 2. 提供サービス仕様

### 料金体系
- **基本料金**: 月額5,000円（税込）
- **従量課金**: コンテンツ追加1件あたり1,500円（税込）
- **決済方法**: Stripeによるクレジットカード支払い
- **請求タイミング**: 毎月末に合算請求（月額 + 使用量）
- **利用チャネル**: LINEから操作（Botによる対話UI）

## 3. ユーザーフロー

### 登録フロー
1. LPにアクセス
2. メールアドレスを入力 → 月額サブスク登録（Stripe決済）
3. 登録完了後、LINE連携ページに遷移

### 利用フロー
1. ユーザーがLINEから「コンテンツ追加」と送信
2. サーバーがStripeにUsage Recordを1件分報告（従量課金）
3. 月末にStripeが合算請求を実行、ユーザーに自動請求通知
4. 支払い完了後、LINEから継続して利用可能

## 4. システム構成

### 技術スタック
| 構成要素 | 役割 |
|---------|------|
| Flaskアプリ | LP表示／LINE Webhook処理／Stripe API連携 |
| HTMLテンプレート | LP（index.html, thanks.html など） |
| Stripe API | 月額課金＋従量課金の統合サブスクリプション管理 |
| LINE Messaging API | ユーザーとの対話（Bot）／コンテンツ追加受け付け |
| Webhook | Stripeの支払い成功通知の受信処理 |
| Railway（想定） | アプリケーションのホスティング（SSL付き） |
| Cursor | コーディング補助（HTML／APIなど） |

## 5. 画面設計（主要画面）

### 画面一覧
| 画面 | 内容 |
|------|------|
| LP（トップページ） | サービス説明、料金、申込みフォーム |
| 登録完了ページ | LINE連携案内／サンクス画面 |
| LINE画面 | 「追加」「利用状況確認」などの操作をBotが対応 |
| 請求完了通知（任意） | Stripeの請求成功後、LINE通知を送る機能も可 |

### デザインシステム
#### ブランドアイデンティティ
- **ロゴ**: AI Collections（ブルーからパープルへのグラデーション）
- **デザインスタイル**: クリーン、モダン、デジタル感
- **カラーパレット**: プライマリグラデーション（#4F46E5 → #7C3AED）

#### 主要デザイン要素
- **タイポグラフィ**: Interフォントファミリー
- **角丸**: 8px〜16pxの適度な角丸
- **シャドウ**: ソフトで自然な影効果
- **アニメーション**: スムーズで控えめな動き

#### LPレイアウト構成
- **ヘッダー**: ロゴ配置、ナビゲーション
- **ヒーローセクション**: グラデーションテキスト、CTAボタン
- **機能紹介セクション**: カード形式、3カラムレイアウト
- **料金セクション**: 料金カード、グラデーションボーダー
- **フッター**: ロゴ、リンク集、法的情報

#### レスポンシブ対応
- モバイルファースト設計
- タッチフレンドリーなUI
- ブレークポイント: 640px, 768px, 1024px, 1280px

### デザイン方針・トンマナ
- ベースカラーは白を基調とし、清潔感・上品さを演出
- アクセントカラーとしてロゴのグラデーション（ブルー〜パープル）を要所で使用
- 添付画像のように、上品で視認性が高く、余白を活かしたレイアウト
- 画像やイラストは使用せず、LINEの実際の画面UI（トーク画面やBotのやりとり）を中心に構成し、サービス内容が直感的に伝わるようにする

## 6. API・Webhook仕様

### Stripe API連携
- **/subscribe**: 月額＋従量課金のSubscription作成
- **report_usage(subscription_item_id)**: コンテンツ追加時に従量1件報告

### LINE連携機能
1. Botが「追加」メッセージを受信 → Flaskで処理
2. そのユーザーのStripe Subscriptionと紐づくsubscription_item_idを照合
3. 使用量（1）をStripeへ送信（UsageRecord）

### Stripe Webhook受信イベント（Flask）
- **invoice.payment_succeeded**: 支払い成功時、LINEに通知可能
- **invoice.payment_failed**: 未決済通知（LINE or メール）

## 7. セキュリティ・認証

### セキュリティ要件
| 項目 | 内容 |
|------|------|
| Stripe署名検証 | Webhookで署名の整合性チェック実装 |
| LINEユーザーID管理 | ユーザーとStripe顧客をDBで紐づけて管理 |
| 入力検証 | フォームやLINEメッセージのバリデーション実装 |
| HTTPS | RailwayやカスタムドメインでSSL対応 |

## 8. 将来的な拡張予定（オプション）

### 拡張機能
- LINEのユーザー向けマイページ（使用件数・履歴確認）
- 定額コンテンツ＋単発診断など複数サービス展開
- 管理者向けダッシュボード（Flask管理画面）

## 9. その他・備考

### 法的要件
- LPにはプライバシーポリシー・特商法表記を明記する

### 運用要件
- Stripe Dashboardで支払い状況・顧客情報を一括管理可能
- 利用開始時、LINEで「サブスク登録完了」の初期メッセージを自動送信

## 10. 開発ロードマップ

### 開発ステップ
| ステップ | 内容 | 目安期間 |
|---------|------|----------|
| STEP 1 | LPと月額課金登録機能（Stripe）構築 | 1〜2日 |
| STEP 2 | LINE Bot構築（Webhook + 追加コマンド） | 2〜3日 |
| STEP 3 | 使用量報告（従量課金API）連携 | 1日 |
| STEP 4 | Webhook受信と通知処理 | 1日 |
| STEP 5 | デザイン調整＋本番デプロイ | 1〜2日 |

### デザイン開発フェーズ
| フェーズ | 内容 | 目安期間 |
|---------|------|----------|
| デザインシステム構築 | カラーパレット、タイポグラフィ、コンポーネント設計 | 0.5日 |
| LPデザイン作成 | ヒーロー、機能紹介、料金セクションのデザイン | 1日 |
| レスポンシブ対応 | モバイル、タブレット、デスクトップ対応 | 0.5日 |
| アニメーション実装 | ホバーエフェクト、スクロールアニメーション | 0.5日 |

### 合計開発期間
**約6〜9日**（デザイン開発含む）

## 11. 技術的詳細

### データベース設計
```sql
-- ユーザーテーブル
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email VARCHAR(255) UNIQUE NOT NULL,
    stripe_customer_id VARCHAR(255) UNIQUE NOT NULL,
    stripe_subscription_id VARCHAR(255) UNIQUE NOT NULL,
    line_user_id VARCHAR(255) UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 使用量ログテーブル
CREATE TABLE usage_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    usage_quantity INTEGER DEFAULT 1,
    stripe_usage_record_id VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 環境変数設定
```bash
# Stripe設定
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...

# LINE設定
LINE_CHANNEL_ACCESS_TOKEN=...
LINE_CHANNEL_SECRET=...

# アプリケーション設定
FLASK_SECRET_KEY=...
DATABASE_URL=...

# デザイン設定
PRIMARY_GRADIENT=linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%)
PRIMARY_BLUE=#4F46E5
PRIMARY_PURPLE=#7C3AED
```

## 12. テスト計画

### 単体テスト
- Stripe API連携テスト
- LINE Bot機能テスト
- Webhook受信テスト

### 統合テスト
- ユーザー登録フロー全体テスト
- 従量課金処理テスト
- 請求通知テスト

### デザインテスト
- レスポンシブデザインテスト（各デバイス）
- ブラウザ互換性テスト
- アクセシビリティテスト（WCAG準拠）
- パフォーマンステスト（画像最適化、CSS最適化）

### 本番環境テスト
- Railwayデプロイテスト
- SSL証明書動作確認
- 実際のStripe決済テスト

## 13. LP画面構成・コピー仕様

### 1. ヒーローセクション
- キャッチコピー：
  - AIが、あなたの秘書になる時代。
- ボディコピー：
  - スマホに話しかけるだけで、日常のタスクがどんどん片付いていく。
- CTA：すぐ登録を促すボタン

### 2. サービス概要
あなたが本当に向き合いたい仕事に、もっと集中するために。
AIコレクションズは、忙しい個人事業主や経営者のための“AI秘書サブスク”。
まるで長年連れ添ったパートナーのように、あなたの一言にスムーズに反応し、煩わしい業務を次々とこなしてくれる頼れるAIたちが、あなたの日常をサポートします。
「AIって、こんなに頼れるんだ」
 そんな驚きと安心を、毎日の中に。
あなただけの“できる秘書たち”が揃ったコレクション、それがAIコレクションズです。

### 3. コンテンツ内容
🔶 AI予定秘書
日程調整のストレスから解放される、スケジュール管理の相棒。
 Googleカレンダーと連携し、LINEで予定の追加・確認・空き時間の提案まで。
 調整のやりとりに追われる時間を、もっとクリエイティブに使えるように。

🔶 AI経理秘書
打合せ後すぐ送れる、スマートな請求書作成アシスタント。
 LINEで項目を送るだけで、見積書や請求書を即作成。
 営業から事務処理までを一気通貫でスムーズに。

🔶 AIタスクコンシェルジュ
今日やるべきことを、ベストなタイミングで。
 登録したタスクを空き時間に自動で配置し、理想的な1日をAIが提案。
 「やりたいのにできない」を、「自然にこなせる」毎日に。

### 4. 料金プラン
- 月額料金：5,000円（税込）
- コンテンツ追加：1件 1,500円（税込）
- 例：
  - 1件だけ使う → 合計6,500円
  - たくさん使いたい → 毎月上限ありでも調整可（今後追加予定）
- CTA：[Stripeで登録する]ボタン

### 5. ご利用の流れ
- Stripeで月額登録
- 登録完了後、LINE連携ボタンでBot追加
- すぐにお使いいただけます
- 月末に使った分だけ自動請求

### 6. よくある質問（FAQ）
- 解約はいつでもできますか？
  - Stripeの管理画面からワンクリックで解約できます
- いつ請求されますか？
  - 毎月末に月額＋使用回数を合算して自動請求されます
- 1回だけ試すことはできますか？
  - はい、月額登録後1件だけ利用してそのまま解約も可能です

### 7. 安心・運営情報
- 特定商取引法に基づく表記（リンク）
- プライバシーポリシー（リンク）
- 問い合わせフォーム

### 8. 最終CTA
- 今すぐAIコレクションズを始めましょう！
- [月額登録]（→Stripe登録）

---

**作成日**: 2024年12月19日  
**バージョン**: 1.0  
**作成者**: AI Assistant 